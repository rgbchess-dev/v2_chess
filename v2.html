<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruy Lopez Test - Refactored Architecture</title>
    
    <!-- Chess assets -->
    <link rel="stylesheet" href="assets/css/chessground.base.css">
    <link rel="stylesheet" href="assets/css/chessground.brown.css">
    <link rel="stylesheet" href="assets/css/chessground.cburnett.css">
    <link rel="stylesheet" href="engine/promotion.css">
    <link rel="stylesheet" href="engine/trainer-styles.css">
    <script src="assets/js/chess.min.js"></script>
</head>
<body>

<div class="trainer-container">
    <div class="header">
        <h1 class="opening-title">♔ Ruy Lopez Training - Architecture Test</h1>
        <p class="opening-subtitle">Testing the refactored engine with a simple opening</p>
    </div>
    
    <div class="controls">
        <div class="control-group">
            <label for="modeSelect">Training Mode:</label>
            <select id="modeSelect">
                <option value="theory">Theory Lines</option>
                <option value="exercises">Exercises</option>
                <option value="spaced_repetition">🧠 Spaced Repetition</option>
            </select>
            
            <label for="categorySelect" id="categoryLabel">Category:</label>
            <select id="categorySelect">
                <!-- Populated by UI Manager -->
            </select>
            
            <label for="colorSelect">Play as:</label>
            <select id="colorSelect">
                <option value="white">White</option>
                <option value="black">Black</option>
                <option value="both" selected>Both Sides</option>
            </select>
        </div>
        
        <div class="control-group">
            <label for="lineSelect">Current Line:</label>
            <select id="lineSelect">
                <!-- Populated by UI Manager -->
            </select>
            <button id="prevLineBtn">← Previous</button>
            <button id="nextLineBtn">Next →</button>
        </div>
        
        <div class="control-group">
            <button id="hintBtn">💡 Show Hint</button>
            <button id="resetBtn">🔄 Reset Position</button>
            <button id="flipBtn">↩️ Flip Board</button>
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>
    
    <div id="positionInfo" class="position-info">
        <!-- Populated by UI Manager -->
    </div>
    
    <div class="challenge-box" id="challengeBox" style="display: none;">
        <!-- For exercises -->
    </div>
    
    <div id="status">Ready to begin!</div>
    
    <div id="board" class="cg-wrap"></div>
    
    <div class="success-message" id="successMessage"></div>
    <div class="error-message" id="errorMessage"></div>
    
    <div id="moves">
        <h3>📝 Move History</h3>
        <div id="movesList"></div>
    </div>
</div>

<!-- Promotion Selector -->
<div class="promotion-selector" id="promotionSelector">
    <div class="promotion-title">Choose Promotion Piece</div>
    <div class="promotion-pieces">
        <div class="promotion-piece white" data-piece="q" title="Queen"></div>
        <div class="promotion-piece white" data-piece="r" title="Rook"></div>
        <div class="promotion-piece white" data-piece="b" title="Bishop"></div>
        <div class="promotion-piece white" data-piece="n" title="Knight"></div>
        <div class="promotion-piece black" data-piece="q" title="Queen"></div>
        <div class="promotion-piece black" data-piece="r" title="Rook"></div>
        <div class="promotion-piece black" data-piece="b" title="Bishop"></div>
        <div class="promotion-piece black" data-piece="n" title="Knight"></div>
    </div>
</div>

<script type="module">
    // Import the refactored modules
    import { ChessTrainer } from './engine/trainer-core.js';
    import { UIManager } from './engine/ui-manager.js';
    import { ruyLopezData } from './data/ruy-lopez-data.js';
    
    // Initialize the trainer with clean separation
    const trainer = new ChessTrainer('board', ruyLopezData, {
        autoStart: true,
        showHints: true,
        defaultColor: 'both'
    });
    
    // Initialize UI Manager to handle all DOM updates
    const uiManager = new UIManager(trainer);
    
    // Log events for debugging the architecture
    console.log('=== RUY LOPEZ ARCHITECTURE TEST ===');
    console.log('Trainer initialized with events-based architecture');
    
    // Add debug event listeners to verify clean separation
    trainer.addEventListener('correctMove', (e) => {
        console.log('✅ Event: correctMove', e.detail);
    });
    
    trainer.addEventListener('incorrectMove', (e) => {
        console.log('❌ Event: incorrectMove', e.detail);
    });
    
    trainer.addEventListener('lineComplete', (e) => {
        console.log('🎉 Event: lineComplete', e.detail);
    });
    
    // Make trainer available for console debugging
    window.trainer = trainer;
    window.uiManager = uiManager;
    
    console.log('Test commands available in console:');
    console.log('- trainer.setMode("exercises")');
    console.log('- trainer.nextLine()');
    console.log('- trainer.flipBoard()');
    console.log('- trainer.getProgress()');
</script>

</body>
</html>